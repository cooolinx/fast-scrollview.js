<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FastScrollView - èŠå¤©è‡ªåŠ¨æ»šåŠ¨ç¤ºä¾‹</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #f0f2f5;
      padding: 20px;
    }

    .header {
      max-width: 1200px;
      margin: 0 auto 20px;
      text-align: center;
    }

    .header h1 {
      font-size: 32px;
      color: #333;
      margin-bottom: 10px;
    }

    .header p {
      color: #666;
      font-size: 16px;
      margin-bottom: 10px;
    }

    .header .tip {
      background: #fff3cd;
      color: #856404;
      padding: 10px 20px;
      border-radius: 8px;
      display: inline-block;
      font-size: 14px;
      margin-top: 10px;
    }

    .container-wrapper {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .demo-panel {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      height: 600px;
    }

    .panel-header {
      padding: 16px 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .panel-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .panel-subtitle {
      font-size: 12px;
      opacity: 0.9;
    }

    .status-info {
      padding: 12px 20px;
      background: #f8f9fa;
      border-bottom: 1px solid #e0e0e0;
      font-size: 13px;
      color: #495057;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #28a745;
      animation: pulse 2s infinite;
    }

    .status-dot.inactive {
      background: #dc3545;
      animation: none;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .scroll-container {
      flex: 1;
      overflow: auto;
      background: white;
    }

    .message {
      padding: 12px 20px;
      border-bottom: 1px solid #f0f0f0;
      animation: fadeIn 0.3s ease-in;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .message-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .message-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 14px;
    }

    .message-author {
      font-weight: 600;
      color: #2d3748;
      font-size: 14px;
    }

    .message-time {
      font-size: 11px;
      color: #a0aec0;
      margin-left: auto;
    }

    .message-content {
      padding-left: 40px;
      color: #4a5568;
      font-size: 14px;
      line-height: 1.5;
    }

    .controls {
      padding: 15px 20px;
      background: #f8f9fa;
      border-top: 1px solid #e0e0e0;
      display: flex;
      gap: 10px;
    }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      background: #667eea;
      color: white;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s;
      font-weight: 500;
    }

    .btn:hover {
      background: #5568d3;
      transform: translateY(-1px);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn-danger {
      background: #dc3545;
    }

    .btn-danger:hover {
      background: #c82333;
    }

    .back-button {
      display: inline-block;
      margin-bottom: 20px;
      padding: 10px 20px;
      background: white;
      color: #667eea;
      text-decoration: none;
      border-radius: 8px;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: all 0.2s;
    }

    .back-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    code {
      background: #f8f9fa;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      color: #e83e8c;
    }
  </style>
</head>
<body>
  <div style="max-width: 1200px; margin: 0 auto;">
    <a href="index.html" class="back-button">â† è¿”å›ç¤ºä¾‹åˆ—è¡¨</a>
  </div>

  <div class="header">
    <h1>ğŸ’¬ èŠå¤©è‡ªåŠ¨æ»šåŠ¨ç¤ºä¾‹</h1>
    <p>æ¼”ç¤º <code>isAtScrollBottom()</code> æ–¹æ³•çš„å®é™…åº”ç”¨</p>
    <div class="tip">
      ğŸ’¡ æç¤ºï¼šå‘ä¸Šæ»šåŠ¨æŸ¥çœ‹å†å²æ¶ˆæ¯æ—¶ï¼Œæ–°æ¶ˆæ¯ä¸ä¼šè‡ªåŠ¨æ»šåŠ¨ã€‚ä¿æŒåœ¨åº•éƒ¨æ—¶ï¼Œæ–°æ¶ˆæ¯ä¼šè‡ªåŠ¨æ»šåŠ¨ã€‚
    </div>
  </div>

  <div class="container-wrapper">
    <!-- å·¦ä¾§ï¼šæ™ºèƒ½è‡ªåŠ¨æ»šåŠ¨ -->
    <div class="demo-panel">
      <div class="panel-header">
        <div class="panel-title">âœ… æ™ºèƒ½è‡ªåŠ¨æ»šåŠ¨</div>
        <div class="panel-subtitle">ä½¿ç”¨ isAtScrollBottom() åˆ¤æ–­</div>
      </div>
      <div class="status-info">
        <div class="status-indicator">
          <div class="status-dot" id="status-dot-1"></div>
          <span id="status-text-1">ç­‰å¾…æ¶ˆæ¯...</span>
        </div>
      </div>
      <div id="container-1" class="scroll-container"></div>
      <div class="controls">
        <button class="btn" onclick="startAutoSend(1)">å¼€å§‹å‘é€æ¶ˆæ¯</button>
        <button class="btn btn-danger" onclick="stopAutoSend(1)">åœæ­¢</button>
      </div>
    </div>

    <!-- å³ä¾§ï¼šå§‹ç»ˆè‡ªåŠ¨æ»šåŠ¨ï¼ˆå¯¹æ¯”ï¼‰ -->
    <div class="demo-panel">
      <div class="panel-header">
        <div class="panel-title">âŒ å¼ºåˆ¶è‡ªåŠ¨æ»šåŠ¨</div>
        <div class="panel-subtitle">æ€»æ˜¯æ»šåŠ¨åˆ°åº•éƒ¨ï¼ˆä½“éªŒå·®ï¼‰</div>
      </div>
      <div class="status-info">
        <div class="status-indicator">
          <div class="status-dot" id="status-dot-2"></div>
          <span id="status-text-2">ç­‰å¾…æ¶ˆæ¯...</span>
        </div>
      </div>
      <div id="container-2" class="scroll-container"></div>
      <div class="controls">
        <button class="btn" onclick="startAutoSend(2)">å¼€å§‹å‘é€æ¶ˆæ¯</button>
        <button class="btn btn-danger" onclick="stopAutoSend(2)">åœæ­¢</button>
      </div>
    </div>
  </div>

  <script src="../dist/fast-scrollview.min.js"></script>
  <script>
    // åˆå§‹æ¶ˆæ¯æ•°æ®
    function generateInitialMessages(count) {
      const messages = [];
      const names = ['Alice', 'Bob', 'Charlie', 'David', 'Emma'];
      const contents = [
        'ä½ å¥½ï¼æ¬¢è¿æ¥åˆ°èŠå¤©å®¤ã€‚',
        'ä»Šå¤©å¤©æ°”ä¸é”™å‘€ã€‚',
        'æœ‰äººåœ¨å—ï¼Ÿ',
        'æˆ‘åˆšçœ‹åˆ°ä¸€ä¸ªæœ‰è¶£çš„æ–°é—»ã€‚',
        'è¿™ä¸ªåŠŸèƒ½çœŸä¸é”™ï¼',
        'å¤§å®¶æ™šä¸Šå¥½ï¼',
        'å‘¨æœ«æœ‰ä»€ä¹ˆè®¡åˆ’å—ï¼Ÿ',
        'æˆ‘æ­£åœ¨å­¦ä¹ æ–°æŠ€æœ¯ã€‚'
      ];

      for (let i = 0; i < count; i++) {
        const now = new Date();
        now.setMinutes(now.getMinutes() - (count - i) * 2);
        
        messages.push({
          id: `msg-${i}`,
          author: names[i % names.length],
          content: contents[i % contents.length],
          time: now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })
        });
      }
      return messages;
    }

    // æ¸²æŸ“æ¶ˆæ¯
    function renderMessage(message) {
      const initial = message.author.charAt(0).toUpperCase();
      return `
        <div class="message-header">
          <div class="message-avatar">${initial}</div>
          <div class="message-author">${message.author}</div>
          <div class="message-time">${message.time}</div>
        </div>
        <div class="message-content">${message.content}</div>
      `;
    }

    // åˆ›å»º ScrollView å®ä¾‹
    const scrollViews = {};
    const timers = {};
    let messageCounter = 100;

    // æ™ºèƒ½è‡ªåŠ¨æ»šåŠ¨ï¼ˆå·¦ä¾§ï¼‰
    scrollViews[1] = new FastScrollView(
      '#container-1',
      generateInitialMessages(20),
      renderMessage,
      { align: 'bottom', bufferThreshold: 2 }
    );

    // å¼ºåˆ¶è‡ªåŠ¨æ»šåŠ¨ï¼ˆå³ä¾§ï¼‰
    scrollViews[2] = new FastScrollView(
      '#container-2',
      generateInitialMessages(20),
      renderMessage,
      { align: 'bottom', bufferThreshold: 2 }
    );

    // å¼€å§‹è‡ªåŠ¨å‘é€æ¶ˆæ¯
    function startAutoSend(panelId) {
      if (timers[panelId]) {
        clearInterval(timers[panelId]);
      }

      const statusDot = document.getElementById(`status-dot-${panelId}`);
      const statusText = document.getElementById(`status-text-${panelId}`);
      
      statusDot.classList.remove('inactive');
      statusText.textContent = 'æ­£åœ¨æ¥æ”¶æ¶ˆæ¯...';

      timers[panelId] = setInterval(() => {
        const now = new Date();
        const names = ['System', 'Bot', 'User', 'Admin'];
        const contents = [
          `è¿™æ˜¯ç¬¬ ${messageCounter} æ¡æ¶ˆæ¯`,
          `æ¶ˆæ¯ç¼–å·: ${messageCounter}`,
          `è‡ªåŠ¨ç”Ÿæˆçš„å†…å®¹ ${messageCounter}`,
          `æµ‹è¯•æ¶ˆæ¯ #${messageCounter}`,
          `Hello! Message ${messageCounter}`
        ];

        const newMessage = {
          id: `auto-${messageCounter++}`,
          author: names[Math.floor(Math.random() * names.length)],
          content: contents[Math.floor(Math.random() * contents.length)],
          time: now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })
        };

        if (panelId === 1) {
          // å·¦ä¾§ï¼šæ™ºèƒ½è‡ªåŠ¨æ»šåŠ¨
          // å…ˆæ£€æŸ¥æ˜¯å¦åœ¨åº•éƒ¨
          const wasAtBottom = scrollViews[1].isAtScrollBottom();
          
          // æ·»åŠ æ¶ˆæ¯
          scrollViews[1].append(newMessage);
          
          // åªæœ‰åœ¨åº•éƒ¨æ—¶æ‰è‡ªåŠ¨æ»šåŠ¨
          if (wasAtBottom) {
            setTimeout(() => {
              scrollViews[1].scrollToBottom();
            }, 50);
          }
        } else {
          // å³ä¾§ï¼šå¼ºåˆ¶è‡ªåŠ¨æ»šåŠ¨ï¼ˆå¯¹æ¯”ï¼‰
          scrollViews[2].append(newMessage);
          
          // æ€»æ˜¯æ»šåŠ¨åˆ°åº•éƒ¨ï¼ˆä½“éªŒå·®ï¼‰
          setTimeout(() => {
            scrollViews[2].scrollToBottom();
          }, 50);
        }
      }, 800); // æ¯ 800ms å‘é€ä¸€æ¡æ¶ˆæ¯
    }

    // åœæ­¢è‡ªåŠ¨å‘é€
    function stopAutoSend(panelId) {
      if (timers[panelId]) {
        clearInterval(timers[panelId]);
        timers[panelId] = null;
      }

      const statusDot = document.getElementById(`status-dot-${panelId}`);
      const statusText = document.getElementById(`status-text-${panelId}`);
      
      statusDot.classList.add('inactive');
      statusText.textContent = 'å·²åœæ­¢';
    }

    // é¡µé¢å¸è½½æ—¶æ¸…ç†å®šæ—¶å™¨
    window.addEventListener('beforeunload', () => {
      stopAutoSend(1);
      stopAutoSend(2);
    });
  </script>
</body>
</html>


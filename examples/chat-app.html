<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>èŠå¤©åº”ç”¨ç¤ºä¾‹ - FastScrollView</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #e5ddd5;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
    }

    h1 {
      color: #075e54;
      text-align: center;
      margin-bottom: 20px;
      font-size: 32px;
    }

    .chat-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 20px rgba(0,0,0,0.1);
      overflow: hidden;
    }

    .chat-header {
      background: #075e54;
      color: white;
      padding: 15px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .chat-title {
      font-size: 18px;
      font-weight: 600;
    }

    .chat-info {
      font-size: 12px;
      opacity: 0.9;
    }

    #scroll-container {
      height: 500px;
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><rect fill="%23e5ddd5" width="100" height="100"/></svg>');
      overflow: auto;
      padding: 10px;
    }

    .message {
      margin-bottom: 12px;
      display: flex;
      animation: fadeIn 0.3s ease-in;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .message-sent {
      justify-content: flex-end;
    }

    .message-received {
      justify-content: flex-start;
    }

    .message-bubble {
      max-width: 70%;
      padding: 8px 12px;
      border-radius: 8px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
      position: relative;
    }

    .message-sent .message-bubble {
      background: #dcf8c6;
      border-bottom-right-radius: 2px;
    }

    .message-received .message-bubble {
      background: white;
      border-bottom-left-radius: 2px;
    }

    .message-text {
      font-size: 14px;
      line-height: 1.5;
      color: #303030;
      word-wrap: break-word;
    }

    .message-time {
      font-size: 11px;
      color: #667781;
      margin-top: 4px;
      text-align: right;
    }

    .message-sender {
      font-size: 12px;
      color: #667781;
      margin-bottom: 4px;
      font-weight: 600;
    }

    .chat-input-container {
      background: #f0f0f0;
      padding: 15px;
      display: flex;
      gap: 10px;
    }

    .chat-input {
      flex: 1;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 24px;
      font-size: 14px;
      outline: none;
    }

    .chat-input:focus {
      border-color: #075e54;
    }

    .send-button {
      background: #075e54;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 24px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .send-button:hover {
      background: #128c7e;
    }

    .controls {
      margin-top: 15px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .control-button {
      background: #075e54;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 6px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .control-button:hover {
      background: #128c7e;
    }

    .loading-messages {
      text-align: center;
      padding: 20px;
      color: #667781;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ’¬ èŠå¤©åº”ç”¨ç¤ºä¾‹</h1>

    <div class="chat-container">
      <div class="chat-header">
        <div>
          <div class="chat-title">ç¾¤èŠ (50,000 æ¡æ¶ˆæ¯)</div>
          <div class="chat-info">åœ¨çº¿ Â· è™šæ‹Ÿæ»šåŠ¨æ¼”ç¤º</div>
        </div>
      </div>

      <div id="scroll-container"></div>

      <div class="chat-input-container">
        <input 
          type="text" 
          class="chat-input" 
          placeholder="è¾“å…¥æ¶ˆæ¯..." 
          id="message-input"
          onkeypress="if(event.key==='Enter') sendMessage()"
        >
        <button class="send-button" onclick="sendMessage()">å‘é€</button>
      </div>
    </div>

    <div class="controls">
      <button class="control-button" onclick="scrollToTop()">â¬†ï¸ æœ€æ—©æ¶ˆæ¯</button>
      <button class="control-button" onclick="scrollToBottom()">â¬‡ï¸ æœ€æ–°æ¶ˆæ¯</button>
      <button class="control-button" onclick="loadMoreMessages()">ğŸ“¥ åŠ è½½ 1000 æ¡</button>
      <button class="control-button" onclick="jumpToMiddle()">ğŸ¯ è·³åˆ°ä¸­é—´</button>
      <button class="control-button" onclick="scrollToMessage()">ğŸ” è·³åˆ°æŒ‡å®šæ¶ˆæ¯</button>
    </div>
  </div>

  <script src="../dist/fast-scrollview.min.js"></script>
  <script>
    // æ¨¡æ‹Ÿç”¨æˆ·åˆ—è¡¨
    const users = [
      { name: 'å¼ ä¸‰', color: '#dcf8c6' },
      { name: 'æå››', color: '#fff' },
      { name: 'ç‹äº”', color: '#fff' },
      { name: 'èµµå…­', color: '#fff' },
      { name: 'å­™ä¸ƒ', color: '#fff' },
      { name: 'æˆ‘', color: '#dcf8c6', isSelf: true }
    ];

    // æ¨¡æ‹Ÿæ¶ˆæ¯å†…å®¹
    const messageTemplates = [
      'ä½ å¥½ï¼',
      'ä»Šå¤©å¤©æ°”ä¸é”™',
      'æœ‰äººåœ¨å—ï¼Ÿ',
      'åˆšæ‰è¯´çš„é‚£ä¸ªæ€ä¹ˆæ ·ï¼Ÿ',
      'å“ˆå“ˆå“ˆå“ˆ',
      'ğŸ‘ğŸ‘ğŸ‘',
      'æ”¶åˆ°äº†ï¼Œè°¢è°¢ï¼',
      'å¥½çš„ï¼ŒçŸ¥é“äº†',
      'è¿™ä¸ªæƒ³æ³•ä¸é”™',
      'æˆ‘ä¹Ÿè¿™ä¹ˆè®¤ä¸º',
      'å¤§å®¶éƒ½åœ¨å¿™ä»€ä¹ˆå‘¢ï¼Ÿ',
      'æ™šä¸Šä¸€èµ·åƒé¥­å§',
      'è¿™ä¸ªé¡¹ç›®è¿›å±•å¦‚ä½•ï¼Ÿ',
      'éœ€è¦å¸®å¿™å—ï¼Ÿ',
      'ğŸ˜ŠğŸ˜ŠğŸ˜Š',
      'ç­‰ä¸€ä¸‹ï¼Œæˆ‘é©¬ä¸Šæ¥',
      'æ²¡é—®é¢˜çš„',
      'å¯ä»¥çš„',
      'è¿™ä¸ªåŠŸèƒ½å¾ˆæ£’ï¼',
      'æ€§èƒ½çœŸçš„å¾ˆå¥½ï¼Œæ»šåŠ¨è¶…çº§æµç•…ï¼'
    ];

    // ç”Ÿæˆæ¶ˆæ¯æ•°æ®
    let messages = [];
    const INITIAL_MESSAGE_COUNT = 50000;

    console.time('ç”Ÿæˆæ¶ˆæ¯æ•°æ®');
    for (let i = 0; i < INITIAL_MESSAGE_COUNT; i++) {
      const user = users[Math.floor(Math.random() * users.length)];
      const template = messageTemplates[Math.floor(Math.random() * messageTemplates.length)];
      const timestamp = new Date(Date.now() - (INITIAL_MESSAGE_COUNT - i) * 60000);
      
      messages.push({
        id: i,
        user: user,
        text: template,
        time: timestamp.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' }),
        timestamp: timestamp
      });
    }
    console.timeEnd('ç”Ÿæˆæ¶ˆæ¯æ•°æ®');

    // æ¸²æŸ“æ¶ˆæ¯
    function renderMessage(message, index, totalSize) {
      const div = document.createElement('div');
      div.className = `message ${message.user.isSelf ? 'message-sent' : 'message-received'}`;
      
      const bubble = document.createElement('div');
      bubble.className = 'message-bubble';
      
      let html = '';
      if (!message.user.isSelf) {
        html += `<div class="message-sender">${message.user.name}</div>`;
      }
      html += `<div class="message-text">${message.text}</div>`;
      html += `<div class="message-time">${message.time}</div>`;
      
      bubble.innerHTML = html;
      div.appendChild(bubble);
      
      return div;
    }

    // åˆ›å»º FastScrollView å®ä¾‹
    console.time('åˆå§‹åŒ–èŠå¤©æ»šåŠ¨');
    const fsv = new FastScrollView(
      '#scroll-container',
      messages,
      renderMessage,
      {
        estimatedItemHeight: 60,
        bufferSize: 5,
        onScroll: (info) => {
          // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ»šåŠ¨äº‹ä»¶å¤„ç†
        }
      }
    );
    console.timeEnd('åˆå§‹åŒ–èŠå¤©æ»šåŠ¨');

    // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨ï¼ˆæœ€æ–°æ¶ˆæ¯ï¼‰
    setTimeout(() => {
      fsv.scrollToBottom();
    }, 100);

    // æ§åˆ¶å‡½æ•°
    function scrollToTop() {
      fsv.scrollToTop();
    }

    function scrollToBottom() {
      fsv.scrollToBottom();
    }

    function jumpToMiddle() {
      const middleIndex = Math.floor(messages.length / 2);
      fsv.scrollToItem(middleIndex);
    }

    function scrollToMessage() {
      const input = prompt('è¾“å…¥æ¶ˆæ¯ç´¢å¼• (0 - ' + (messages.length - 1) + '):', '1000');
      if (input !== null) {
        const index = parseInt(input);
        if (!isNaN(index) && index >= 0 && index < messages.length) {
          fsv.scrollToItem(index);
        } else {
          alert('æ— æ•ˆçš„ç´¢å¼•');
        }
      }
    }

    function sendMessage() {
      const input = document.getElementById('message-input');
      const text = input.value.trim();
      
      if (text) {
        const newMessage = {
          id: Date.now(),
          user: users.find(u => u.isSelf),
          text: text,
          time: new Date().toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' }),
          timestamp: new Date()
        };
        
        fsv.append(newMessage);
        input.value = '';
        
        // æ»šåŠ¨åˆ°åº•éƒ¨æŸ¥çœ‹æ–°æ¶ˆæ¯
        setTimeout(() => {
          fsv.scrollToBottom();
        }, 50);
      }
    }

    function loadMoreMessages() {
      console.time('åŠ è½½æ›´å¤šæ¶ˆæ¯');
      for (let i = 0; i < 1000; i++) {
        const user = users[Math.floor(Math.random() * users.length)];
        const template = messageTemplates[Math.floor(Math.random() * messageTemplates.length)];
        const timestamp = new Date();
        
        const newMessage = {
          id: Date.now() + i,
          user: user,
          text: template,
          time: timestamp.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' }),
          timestamp: timestamp
        };
        
        fsv.append(newMessage);
      }
      console.timeEnd('åŠ è½½æ›´å¤šæ¶ˆæ¯');
      alert('å·²æ·»åŠ  1000 æ¡æ¶ˆæ¯ï¼');
    }

    console.log('èŠå¤©åº”ç”¨å·²åˆå§‹åŒ–');
    console.log(`æ¶ˆæ¯æ€»æ•°: ${messages.length.toLocaleString()} æ¡`);
    console.log(`DOM ä¸­å®é™…æ¸²æŸ“: ~${fsv.getVisibleRange().count} ä¸ªæ¶ˆæ¯å…ƒç´ `);
  </script>
</body>
</html>


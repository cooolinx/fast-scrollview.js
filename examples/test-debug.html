<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è°ƒè¯•è·³åŠ¨é—®é¢˜</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: monospace;
      padding: 20px;
      background: #f5f5f5;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
    }

    h1 {
      margin-bottom: 20px;
      color: #333;
    }

    .info {
      background: white;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .info-row {
      display: grid;
      grid-template-columns: 150px 1fr;
      gap: 10px;
      padding: 5px 0;
      border-bottom: 1px solid #eee;
    }

    .info-row:last-child {
      border-bottom: none;
    }

    .label {
      font-weight: bold;
      color: #666;
    }

    #scroll-container {
      height: 400px;
      border: 2px solid #333;
      border-radius: 8px;
      overflow: auto;
      background: white;
    }

    .item {
      padding: 20px;
      border-bottom: 1px solid #ddd;
      background: white;
      transition: background 0.2s;
    }

    .item:hover {
      background: #f0f0f0;
    }

    .item-index {
      font-weight: bold;
      font-size: 16px;
      color: #007bff;
      margin-bottom: 5px;
    }

    .item-content {
      color: #666;
      line-height: 1.6;
    }

    .item-height {
      font-size: 12px;
      color: #999;
      margin-top: 5px;
    }

    /* ä¸åŒé«˜åº¦çš„item */
    .height-small { min-height: 60px; background: #e3f2fd !important; }
    .height-medium { min-height: 100px; background: #f3e5f5 !important; }
    .height-large { min-height: 150px; background: #fff3e0 !important; }

    .log {
      background: #1e1e1e;
      color: #00ff00;
      padding: 15px;
      border-radius: 8px;
      max-height: 300px;
      overflow-y: auto;
      font-size: 12px;
      line-height: 1.4;
      margin-top: 10px;
    }

    .log-item {
      padding: 2px 0;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .log-error {
      color: #ff5555;
    }

    .log-warning {
      color: #ffff55;
    }

    .log-info {
      color: #55ffff;
    }

    .buttons {
      margin-bottom: 10px;
      display: flex;
      gap: 10px;
    }

    button {
      padding: 10px 20px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    }

    button:hover {
      background: #0056b3;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” è°ƒè¯•è™šæ‹Ÿæ»šåŠ¨è·³åŠ¨é—®é¢˜</h1>

    <div class="buttons">
      <button onclick="scrollToIndex(5)">æ»šåŠ¨åˆ° #5</button>
      <button onclick="scrollToIndex(10)">æ»šåŠ¨åˆ° #10</button>
      <button onclick="scrollToIndex(20)">æ»šåŠ¨åˆ° #20</button>
      <button onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
    </div>

    <div class="info">
      <div class="info-row">
        <span class="label">æ»šåŠ¨ä½ç½®:</span>
        <span id="scroll-pos">0px</span>
      </div>
      <div class="info-row">
        <span class="label">å¯è§èŒƒå›´:</span>
        <span id="visible-range">0 - 0</span>
      </div>
      <div class="info-row">
        <span class="label">topSpacer:</span>
        <span id="top-spacer">0px</span>
      </div>
      <div class="info-row">
        <span class="label">bottomSpacer:</span>
        <span id="bottom-spacer">0px</span>
      </div>
      <div class="info-row">
        <span class="label">ç¼“å­˜å¤§å°:</span>
        <span id="cache-size">0</span>
      </div>
    </div>

    <div id="scroll-container"></div>

    <div class="log" id="log"></div>
  </div>

  <script src="../dist/fast-scrollview.min.js"></script>
  <script>
    const logs = [];
    
    function addLog(message, type = 'info') {
      const time = new Date().toLocaleTimeString();
      const className = `log-${type}`;
      logs.unshift(`<div class="log-item ${className}">[${time}] ${message}</div>`);
      if (logs.length > 50) logs.pop();
      
      document.getElementById('log').innerHTML = logs.join('');
    }

    function clearLog() {
      logs.length = 0;
      document.getElementById('log').innerHTML = '';
      addLog('æ—¥å¿—å·²æ¸…é™¤');
    }

    // åˆ›å»ºå›ºå®šé«˜åº¦çš„æµ‹è¯•æ•°æ®
    const items = [];
    const heights = ['small', 'medium', 'large'];
    
    for (let i = 0; i < 30; i++) {
      const heightType = heights[i % 3];
      items.push({
        id: i,
        heightType: heightType,
        content: `è¿™æ˜¯ç¬¬ ${i} æ¡æ•°æ®ï¼Œé«˜åº¦ç±»å‹ï¼š${heightType}`
      });
    }

    addLog(`ç”Ÿæˆäº† ${items.length} æ¡æ•°æ®`);

    // æ¸²æŸ“å‡½æ•°
    function renderItem(item, index, totalSize) {
      const div = document.createElement('div');
      div.className = `item height-${item.heightType}`;
      div.innerHTML = `
        <div class="item-index">Item #${index}</div>
        <div class="item-content">${item.content}</div>
        <div class="item-height">é«˜åº¦ç±»å‹: ${item.heightType}</div>
      `;
      return div;
    }

    // åˆ›å»º FastScrollView
    addLog('åˆå§‹åŒ– FastScrollView...');
    
    const fsv = new FastScrollView(
      '#scroll-container',
      items,
      renderItem,
      {
        estimatedItemHeight: 80,
        bufferSize: 2,
        onScroll: (info) => {
          updateInfo();
          addLog(`æ»šåŠ¨äº‹ä»¶: scrollTop=${Math.round(info.scrollTop)}, range=${info.visibleStart}-${info.visibleEnd}`);
        }
      }
    );

    addLog('âœ… FastScrollView åˆå§‹åŒ–å®Œæˆ', 'info');

    // æ›´æ–°ä¿¡æ¯
    function updateInfo() {
      const range = fsv.getVisibleRange();
      const topSpacerHeight = fsv.topSpacer.style.height;
      const bottomSpacerHeight = fsv.bottomSpacer.style.height;
      const cacheSize = fsv.renderedCache.size;

      document.getElementById('visible-range').textContent = `${range.start} - ${range.end}`;
      document.getElementById('top-spacer').textContent = topSpacerHeight;
      document.getElementById('bottom-spacer').textContent = bottomSpacerHeight;
      document.getElementById('cache-size').textContent = cacheSize;
    }

    function scrollToIndex(index) {
      addLog(`æ‰‹åŠ¨æ»šåŠ¨åˆ°ç´¢å¼• ${index}`, 'warning');
      fsv.scrollToItem(index);
      updateInfo();
    }

    // åˆå§‹æ›´æ–°
    updateInfo();

    // ç›‘å¬å®é™…çš„æ»šåŠ¨äº‹ä»¶ï¼Œè®°å½•è¯¦ç»†ä¿¡æ¯
    let lastScrollTop = 0;
    fsv.container.addEventListener('scroll', () => {
      const currentScrollTop = fsv.container.scrollTop;
      const delta = currentScrollTop - lastScrollTop;
      
      if (Math.abs(delta) > 50) {
        addLog(`âš ï¸ å¤§å¹…è·³åŠ¨æ£€æµ‹! delta=${delta.toFixed(1)}px`, 'error');
      }
      
      lastScrollTop = currentScrollTop;
    });

    addLog('ğŸ“Š å¼€å§‹ç›‘æ§æ»šåŠ¨è¡Œä¸º...');
  </script>
</body>
</html>

